<app-navbar></app-navbar>
<section class="event-list">
  <!-- HEADER -->
  <header class="event-list__header">
    <h1 class="event-list__title">Discover Events</h1>
    <p class="event-list__subtitle">
      Find and explore amazing events happening near you.
    </p>
  </header>

  <!-- SEARCH & FILTERS -->
  <div class="event-list__filters">
    <!-- Search Bar -->
    <div class="event-list__search">
      <span class="material-symbols-outlined">search</span>
      <input type="text" placeholder="Search events by name, venue, or description..." [value]="searchQuery"
        (input)="onSearchInput($event)" class="event-list__search-input" />
    </div>

    <!-- Category Pills -->
    <div class="event-list__categories">
      <button class="category-pill" [class.category-pill--active]="selectedCategory === null"
        (click)="selectCategory(null)">
        <span class="material-symbols-outlined">apps</span>
        All Events
      </button>
      <button *ngFor="let category of categories" class="category-pill"
        [class.category-pill--active]="selectedCategory === category.id" (click)="selectCategory(category.id)">
        <span class="material-symbols-outlined">{{ getCategoryIcon(category.icon) }}</span>
        {{ category.name }}
      </button>
    </div>

    <!-- Organizer Filter & Clear -->
    <div class="event-list__filter-row">
      <div class="event-list__organizer-filter">
        <label>Filter by Organizer:</label>
        <select [ngModel]="selectedOrganizer" (ngModelChange)="selectOrganizer($event)"
          class="event-list__organizer-select">
          <option [ngValue]="null">All Organizers</option>
          <option *ngFor="let organizer of organizers" [ngValue]="organizer.id">
            {{ organizer.name }}
          </option>
        </select>
      </div>

      <button *ngIf="hasActiveFilters()" class="event-list__clear-btn" (click)="clearFilters()">
        <span class="material-symbols-outlined">close</span>
        Clear Filters
      </button>
    </div>

    <!-- Active Filters Display -->
    <div *ngIf="hasActiveFilters()" class="event-list__active-filters">
      <span class="material-symbols-outlined">filter_alt</span>
      <span class="active-filters__label">Active Filters:</span>
      <span *ngIf="searchQuery" class="active-filter-tag">
        "{{ searchQuery }}"
      </span>
      <span *ngIf="selectedCategory" class="active-filter-tag">
        {{ getCategoryName(selectedCategory) }}
      </span>
      <span *ngIf="selectedOrganizer" class="active-filter-tag">
        by {{ getOrganizerName(selectedOrganizer) }}
      </span>
    </div>
  </div>

  <!-- LOADING STATE -->
  <div *ngIf="loading" class="event-list__grid">
    <div class="event-card event-card--skeleton" *ngFor="let i of [1, 2, 3, 4, 5, 6]"></div>
  </div>

  <!-- ERROR STATE -->
  <div *ngIf="error" class="event-list__state">
    <div class="event-list__error-card">
      <div class="event-list__error-icon">!</div>

      <h3 class="event-list__error-title">Failed to load events</h3>

      <p class="event-list__error-text">
        Something went wrong while fetching the event data. Please try again.
      </p>

      <button class="event-list__retry-button" (click)="fetchEvents()">
        Retry
      </button>
    </div>
  </div>

  <!-- EMPTY STATE -->
  <div *ngIf="!loading && !error && events.length === 0" class="event-list__state">
    <div class="event-list__empty-card">
      <div class="event-list__empty-icon">ğŸ”</div>

      <h3 class="event-list__empty-title">No events found</h3>

      <p class="event-list__empty-text">
        We couldn't find any events matching your criteria.
        <span *ngIf="hasActiveFilters()">Try adjusting your filters or search terms.</span>
      </p>

      <button *ngIf="hasActiveFilters()" class="event-list__retry-button" (click)="clearFilters()">
        Clear Filters
      </button>
    </div>
  </div>

  <!-- EVENTS GRID -->
  <div *ngIf="!loading && !error && events.length > 0" class="event-list__grid">
    <article class="event-card" *ngFor="let event of events" [routerLink]="['/events', event.id]">
      <!-- EVENT IMAGE -->
      <div class="event-card__media">
        <img [src]="event.image_url || getDefaultImage(event.category_name)" [alt]="event.name"
          class="event-card__image" (error)="$any($event.target).src = 'assets/events/tech_conference.png'" />
        <span class="event-card__badge">
          {{ event.category_name || 'Event' }}
        </span>
        <span *ngIf="event.is_featured" class="event-card__featured">â­ Featured</span>
      </div>

      <!-- CONTENT -->
      <div class="event-card__content">
        <h3 class="event-card__name">
          {{ event.name }}
        </h3>

        <div class="event-card__meta">
          <span class="event-card__date">
            ğŸ“… {{ event.date_time | date : "MMM dd, yyyy â€¢ hh:mm a" }}
          </span>
          <span class="event-card__venue">
            ğŸ“ {{ event.venue }}
          </span>
        </div>

        <p class="event-card__description">
          {{ event.description | slice:0:120 }}{{ event.description && event.description.length > 120 ? '...' : '' }}
        </p>

        <div class="event-card__footer">
          <div class="event-card__price">
            <span *ngIf="event.ticket_price && event.ticket_price > 0" class="price">${{ event.ticket_price }}</span>
            <span *ngIf="!event.ticket_price || event.ticket_price === 0" class="price free">FREE</span>
          </div>
          <div class="event-card__availability">
            <span class="seats">{{ (event.capacity || 0) - (event.tickets_booked || 0) }} seats left</span>
          </div>
          <button class="event-card__button">View Details â†’</button>
        </div>
      </div>
    </article>
  </div>
</section>