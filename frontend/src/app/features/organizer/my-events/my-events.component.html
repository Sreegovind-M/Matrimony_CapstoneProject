<app-navbar></app-navbar>

<div class="my-events-container">
  <!-- Header Section -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">My Events</h1>
      <p class="page-subtitle">Manage and organize all your events in one place</p>
    </div>
    <!-- <a routerLink="/organizer/create-event" class="btn-create">
      <span class="material-symbols-outlined">add</span>
      Create New Event
    </a> -->
  </div>

  <!-- Stats Bar -->
  <div class="stats-bar">
    <div class="stat-item">
      <span class="stat-number">{{ allEvents.length }}</span>
      <span class="stat-label">Total Events</span>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
      <span class="stat-number upcoming">{{ upcomingCount }}</span>
      <span class="stat-label">Upcoming</span>
    </div>
    <div class="stat-divider"></div>
    <div class="stat-item">
      <span class="stat-number completed">{{ pastCount }}</span>
      <span class="stat-label">Completed</span>
    </div>
  </div>

  <!-- Filters and Controls -->
  <div class="controls-section">
    <div class="filters-row">
      <!-- Search Bar -->
      <div class="search-container">
        <span class="material-symbols-outlined search-icon">search</span>
        <input type="text" class="search-input" placeholder="Search events by name, venue, or category..."
          [(ngModel)]="searchQuery" (ngModelChange)="onSearchChange()" />
      </div>

      <!-- View Mode Toggle -->
      <button class="view-toggle" (click)="toggleViewMode()"
        [title]="viewMode === 'grid' ? 'Switch to List View' : 'Switch to Grid View'">
        <span class="material-symbols-outlined" *ngIf="viewMode === 'grid'">view_list</span>
        <span class="material-symbols-outlined" *ngIf="viewMode === 'list'">view_module</span>
      </button>
    </div>

    <div class="filters-actions-row">
      <!-- Filter Buttons -->
      <div class="filter-buttons">
        <button class="filter-btn" [class.active]="activeFilter === 'all'" (click)="setFilter('all')">
          All Events
        </button>
        <button class="filter-btn" [class.active]="activeFilter === 'upcoming'" (click)="setFilter('upcoming')">
          Upcoming
        </button>
        <button class="filter-btn" [class.active]="activeFilter === 'past'" (click)="setFilter('past')">
          Past
        </button>
      </div>

      <!-- Sort Dropdown -->
      <div class="sort-container">
        <label class="sort-label">Sort by:</label>
        <select class="sort-select" [(ngModel)]="sortBy" (ngModelChange)="applyFilters()">
          <option value="date">Date</option>
          <option value="name">Name</option>
          <option value="capacity">Capacity</option>
        </select>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="spinner"></div>
    <p>Loading your events...</p>
  </div>

  <!-- Empty State -->
  <div *ngIf="!isLoading && filteredEvents.length === 0" class="empty-state">
    <div class="empty-icon">ðŸ“…</div>
    <h2 class="empty-title">No Events Found</h2>
    <p class="empty-description" *ngIf="searchQuery">
      No events match your search criteria. Try adjusting your filters.
    </p>
    <p class="empty-description" *ngIf="!searchQuery && activeFilter !== 'all'">
      No {{ activeFilter }} events available.
    </p>
    <p class="empty-description" *ngIf="!searchQuery && activeFilter === 'all'">
      You haven't created any events yet.
    </p>
    <a routerLink="/organizer/create-event" class="btn-create-large">
      <span class="material-symbols-outlined">add</span>
      Create Your First Event
    </a>
  </div>

  <!-- Events Grid View -->
  <div *ngIf="!isLoading && filteredEvents.length > 0 && viewMode === 'grid'" class="events-grid">
    <div *ngFor="let event of filteredEvents" class="event-card">
      <!-- Status Badge -->
      <div class="status-badge" [style.background-color]="getStatusColor(getEventStatus(event))">
        {{ getEventStatus(event) | uppercase }}
      </div>

      <!-- Event Image - NOW WITH REAL IMAGES -->
      <div class="event-image-container">
        <img [src]="event.image_url || getDefaultImage(event.category_name || event.category)" [alt]="event.name"
          class="event-image" (error)="$any($event.target).src = 'assets/events/tech_conference.png'" />
        <div class="event-category-tag">{{ event.category_name || event.category || 'Event' }}</div>
        <div class="event-date-overlay">
          <span class="overlay-day">{{ formatDate(event.date_time).split(' ')[1] }}</span>
          <span class="overlay-month">{{ formatDate(event.date_time).split(' ')[0] }}</span>
        </div>
      </div>

      <!-- Event Details -->
      <div class="event-card-body">
        <h3 class="event-card-title">{{ event.name }}</h3>

        <div class="event-info-grid">
          <div class="info-item">
            <span class="material-symbols-outlined info-icon">location_on</span>
            <span class="info-text">{{ event.venue }}</span>
          </div>
          <div class="info-item">
            <span class="material-symbols-outlined info-icon">schedule</span>
            <span class="info-text">{{ formatTime(event.date_time) }}</span>
          </div>
          <div class="info-item">
            <span class="material-symbols-outlined info-icon">group</span>
            <span class="info-text">{{ event.capacity }} seats</span>
          </div>
          <div class="info-item">
            <span class="material-symbols-outlined info-icon">confirmation_number</span>
            <span class="info-text">{{ event.tickets_booked || 0 }} booked</span>
          </div>
        </div>

        <div class="event-price-row">
          <span class="price" *ngIf="event.ticket_price && event.ticket_price > 0">${{ event.ticket_price }}</span>
          <span class="price free" *ngIf="!event.ticket_price || event.ticket_price === 0">FREE</span>
          <span class="availability">{{ (event.capacity || 0) - (event.tickets_booked || 0) }} available</span>
        </div>

        <!-- Action Buttons -->
        <div class="event-actions">
          <button class="action-btn btn-view" [routerLink]="['/events', event.id]" title="View Event">
            <span class="material-symbols-outlined">visibility</span>
            View
          </button>
          <button class="action-btn btn-edit" (click)="editEvent(event)" title="Edit Event">
            <span class="material-symbols-outlined">edit</span>
            Edit
          </button>
          <button class="action-btn btn-attendees" (click)="viewAttendees(event)" title="View Attendees">
            <span class="material-symbols-outlined">people</span>
            Attendees
          </button>
          <button class="action-btn btn-delete" (click)="deleteEvent(event.id, event.name)" title="Delete Event">
            <span class="material-symbols-outlined">delete</span>
            Delete
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Events List View -->
  <div *ngIf="!isLoading && filteredEvents.length > 0 && viewMode === 'list'" class="events-list-view">
    <div class="list-header">
      <div class="list-col col-event">Event</div>
      <div class="list-col col-date">Date & Time</div>
      <div class="list-col col-venue">Venue</div>
      <div class="list-col col-capacity">Bookings</div>
      <div class="list-col col-status">Status</div>
      <div class="list-col col-actions">Actions</div>
    </div>

    <div *ngFor="let event of filteredEvents" class="list-row">
      <div class="list-col col-event">
        <div class="event-name-wrapper">
          <img [src]="event.image_url || getDefaultImage(event.category_name || event.category)" [alt]="event.name"
            class="list-event-image" (error)="$any($event.target).src = 'assets/events/tech_conference.png'" />
          <div class="event-name-details">
            <h4 class="list-event-name">{{ event.name }}</h4>
            <span class="list-category">{{ event.category_name || event.category || 'Event' }}</span>
          </div>
        </div>
      </div>
      <div class="list-col col-date">
        <div class="date-wrapper">
          <span class="date-value">{{ formatDate(event.date_time) }}</span>
          <span class="time-value">{{ formatTime(event.date_time) }}</span>
        </div>
      </div>
      <div class="list-col col-venue">
        <span class="venue-text">{{ event.venue }}</span>
      </div>
      <div class="list-col col-capacity">
        <div class="booking-progress">
          <span class="booking-count">{{ event.tickets_booked || 0 }}/{{ event.capacity }}</span>
          <div class="progress-bar">
            <div class="progress-fill" [style.width.%]="((event.tickets_booked || 0) / event.capacity) * 100"></div>
          </div>
        </div>
      </div>
      <div class="list-col col-status">
        <span class="status-pill" [style.background-color]="getStatusColor(getEventStatus(event))">
          {{ getEventStatus(event) }}
        </span>
      </div>
      <div class="list-col col-actions">
        <div class="list-actions">
          <button class="list-action-btn" [routerLink]="['/events', event.id]" title="View">
            <span class="material-symbols-outlined">visibility</span>
          </button>
          <button class="list-action-btn" (click)="editEvent(event)" title="Edit">
            <span class="material-symbols-outlined">edit</span>
          </button>
          <button class="list-action-btn" (click)="viewAttendees(event)" title="Attendees">
            <span class="material-symbols-outlined">people</span>
          </button>
          <button class="list-action-btn danger" (click)="deleteEvent(event.id, event.name)" title="Delete">
            <span class="material-symbols-outlined">delete</span>
          </button>
        </div>
      </div>
    </div>
  </div>
</div>